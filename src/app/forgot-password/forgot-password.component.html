<main class="auth">
  <div class="auth-bg" aria-hidden="true"></div>

  <section class="auth-card card">
    <!-- Success State: Email Sent -->
    <div *ngIf="emailSent" class="success-state">
      <div class="success-icon">ğŸ“©</div>
      <h1>Kiá»ƒm tra hÃ²m thÆ° cá»§a báº¡n</h1>
      <p class="success-text">
        ChÃºng tÃ´i Ä‘Ã£ gá»­i link khÃ´i phá»¥c Ä‘áº¿n email <strong>{{ email }}</strong
        >.<br />
        Vui lÃ²ng kiá»ƒm tra cáº£ hÃ²m thÆ° <strong>Spam</strong>.
      </p>

      <div *ngIf="successMessage" class="alert alert-success" role="status">
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
        {{ errorMessage }}
      </div>

      <button
        class="btn btn-block btn-gmail"
        type="button"
        (click)="openGmail()"
      >
        ğŸ“§ Má»Ÿ Gmail ngay
      </button>

      <div class="resend-section">
        <p *ngIf="resendCountdown > 0" class="resend-text">
          ChÆ°a nháº­n Ä‘Æ°á»£c email? Gá»­i láº¡i sau
          <strong>{{ resendCountdown }}s</strong>
        </p>
        <button
          *ngIf="resendCountdown === 0"
          class="btn-link"
          type="button"
          (click)="resendEmail()"
          [disabled]="loading"
        >
          <span
            *ngIf="loading"
            class="spinner-border spinner-border-sm mr-1"
          ></span>
          {{ loading ? "Äang gá»­i..." : "Gá»­i láº¡i email" }}
        </button>
      </div>

      <div class="text-center mt-4">
        <button class="link" type="button" (click)="resetForm()">
          â† Thá»­ email khÃ¡c
        </button>
      </div>
    </div>

    <!-- Initial Form State -->
    <div *ngIf="!emailSent">
      <h1>QuÃªn máº­t kháº©u</h1>
      <p class="subtitle">
        Nháº­p email Ä‘Ã£ Ä‘Äƒng kÃ½ Ä‘á»ƒ nháº­n liÃªn káº¿t Ä‘áº·t láº¡i máº­t kháº©u.
      </p>

      <form #form="ngForm" (ngSubmit)="onSubmit(form)" novalidate>
        <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
          {{ errorMessage }}
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            required
            email
            [(ngModel)]="email"
            #emailModel="ngModel"
            [class.is-invalid]="emailModel.invalid && emailModel.touched"
            placeholder="vÃ­ dá»¥: hocvien@phuongtu.edu.vn"
          />
          <div
            *ngIf="emailModel.invalid && emailModel.touched"
            class="invalid-feedback"
          >
            Vui lÃ²ng nháº­p email há»£p lá»‡.
          </div>
        </div>

        <!-- TODO: Add reCAPTCHA here when ready -->
        <!-- <div class="recaptcha-container">
          <div class="g-recaptcha" data-sitekey="YOUR_SITE_KEY"></div>
        </div> -->

        <button
          class="btn btn-block"
          type="submit"
          [disabled]="form.invalid || loading"
        >
          <span
            *ngIf="loading"
            class="spinner-border spinner-border-sm mr-1"
          ></span>
          {{ loading ? "Äang gá»­i..." : "Gá»­i hÆ°á»›ng dáº«n" }}
        </button>

        <div class="text-center mt-3">
          <a routerLink="/login" class="link">â† Quay láº¡i Ä‘Äƒng nháº­p</a>
        </div>
      </form>
    </div>
  </section>
</main>
