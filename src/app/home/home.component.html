<section class="hero-panel">
  <div class="aurora-background">
    <div class="aurora__item"></div>
    <div class="aurora__item"></div>
    <div class="aurora__item"></div>
    <div class="aurora__item"></div>
  </div>
  <div class="hero-content">
    <div class="hero-text">
      <p class="eyebrow">CH√ÄO M·ª™NG C√ÅC EM ƒê·∫æN V·ªöI</p>
      <h1>Th∆∞ Vi·ªán Tr∆∞·ªùng THCS Ph∆∞∆°ng T√∫</h1>
      <p class="subtitle">
        Kh∆°i ngu·ªìn tri th·ª©c - Th·∫Øp s√°ng ∆∞·ªõc m∆°. <br />
        N∆°i c√°c em t√¨m th·∫•y nh·ªØng cu·ªën s√°ch hay ph·ª•c v·ª• h·ªçc t·∫≠p v√† gi·∫£i tr√≠.
      </p>
      <p class="current-time">H√¥m nay: {{ currentTime }}</p>
      <form (ngSubmit)="searchBooks()" class="search-form">
        <i class="fa-solid fa-magnifying-glass search-icon"></i>
        <input
          [(ngModel)]="searchTerm"
          (input)="onSearchInput(searchTerm)"
          name="searchTerm"
          type="search"
          placeholder="Nh·∫≠p t√™n s√°ch, t√°c gi·∫£ ho·∫∑c m√¥n h·ªçc..."
          autocomplete="off"
        />
        <button class="btn-search" type="submit">T√¨m Ki·∫øm</button>

        <!-- Autocomplete Suggestions -->
        <div class="search-suggestions" *ngIf="showSuggestions">
          <div
            class="suggestion-item"
            *ngFor="let book of searchSuggestions"
            (click)="selectSuggestion(book)"
          >
            <img
              [src]="
                book.coverUrl ||
                'https://placehold.co/40x60/161B22/8b949e?text=' +
                  (book.name || '?').substring(0, 1)
              "
              alt="{{ book.name }}"
            />
            <div class="suggestion-info">
              <strong>{{ book.name }}</strong>
              <small *ngIf="book.authors && book.authors.length > 0">{{
                book.authors[0].name
              }}</small>
            </div>
          </div>
        </div>
      </form>
      <div class="cta-buttons">
        <a class="btn btn-primary" routerLink="/borrow-book">
          <i class="fa-solid fa-book-open"></i>
          <span>V√†o Kho S√°ch</span>
        </a>
        <a
          *ngIf="userAuthService.isAdmin()"
          class="btn btn-secondary"
          routerLink="/create-book"
        >
          <i class="fa-solid fa-plus"></i>
          <span>Th√™m S√°ch M·ªõi</span>
        </a>
      </div>
    </div>
    <figure class="hero-image" aria-hidden="true">
      <img
        src="https://images.unsplash.com/photo-1497633762265-9d179a990aa6?q=80&w=2073&auto=format&fit=crop"
        alt="Th∆∞ vi·ªán tr∆∞·ªùng h·ªçc"
      />
    </figure>
  </div>
</section>

<section class="categories-section">
  <div class="section-wrap">
    <h2 class="section-title">Danh M·ª•c S√°ch</h2>
    <div class="category-chips">
      <a
        class="chip"
        *ngFor="let category of categories$ | async"
        [routerLink]="['/borrow-book']"
        [queryParams]="{ genre: category }"
      >
        {{ category }}
      </a>
    </div>
  </div>
</section>

<!-- NEWS SECTION -->
<section class="news-section">
  <div class="section-wrap">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-bullhorn"></i>
        B·∫£ng Tin Th∆∞ Vi·ªán
      </h2>
    </div>

    <ng-container *ngIf="news$ | async as news; else loadingNews">
      <div class="news-grid" *ngIf="news.length > 0; else emptyNews">
        <article class="news-card" *ngFor="let item of news">
          <div class="news-icon">
            <i class="fas fa-newspaper"></i>
          </div>
          <div class="news-content">
            <h3 class="news-title">{{ item.title }}</h3>
            <p class="news-excerpt">{{ item.content.substring(0, 120) }}...</p>
            <div class="news-meta">
              <span class="news-date">
                <i class="far fa-calendar"></i>
                {{ formatDate(item.createdAt) }}
              </span>
            </div>
          </div>
        </article>
      </div>
    </ng-container>

    <ng-template #loadingNews>
      <div class="news-grid">
        <div class="news-card-skeleton" *ngFor="let i of [1, 2, 3]"></div>
      </div>
    </ng-template>

    <ng-template #emptyNews>
      <p class="text-muted text-center py-4">
        <i class="fas fa-info-circle"></i>
        Hi·ªán t·∫°i ch∆∞a c√≥ th√¥ng b√°o m·ªõi.
      </p>
    </ng-template>
  </div>
</section>

<!-- LEADERBOARD SECTION -->
<section
  class="leaderboard-section"
  *ngIf="leaderboard$ | async as leaderboard"
>
  <div class="section-wrap">
    <div class="leaderboard-container">
      <div class="leaderboard-header">
        <i class="fas fa-trophy"></i>
        <h2>B·∫£ng V√†ng ƒê·ªçc S√°ch</h2>
        <p>Top 5 ƒë·ªôc gi·∫£ xu·∫•t s·∫Øc th√°ng n√†y</p>
      </div>

      <div
        class="leaderboard-list"
        *ngIf="leaderboard.length > 0; else emptyLeaderboard"
      >
        <div
          class="leaderboard-item"
          *ngFor="let entry of leaderboard; let i = index"
          [class.top-3]="i < 3"
        >
          <div class="rank rank-{{ i + 1 }}">
            <span *ngIf="i === 0">ü•á</span>
            <span *ngIf="i === 1">ü•à</span>
            <span *ngIf="i === 2">ü•â</span>
            <span *ngIf="i >= 3">{{ i + 1 }}</span>
          </div>
          <div class="player-info">
            <div class="player-name">{{ entry.userName }}</div>
            <div class="player-level">
              <span
                class="level-badge"
                [ngClass]="getLevelBadgeClass(entry.level)"
              >
                Level {{ entry.level }}
              </span>
            </div>
          </div>
          <div class="player-stats">
            <div class="points">{{ entry.totalPoints }} ƒëi·ªÉm</div>
            <div class="badges-count">
              <i class="fas fa-medal"></i>
              {{ entry.badgeCount }}
            </div>
          </div>
        </div>
      </div>

      <ng-template #emptyLeaderboard>
        <p class="text-muted text-center py-4">
          Ch∆∞a c√≥ d·ªØ li·ªáu b·∫£ng x·∫øp h·∫°ng.
        </p>
      </ng-template>
    </div>
  </div>
</section>

<!-- RECOMMENDED BOOKS SECTION (for logged-in users) -->
<section
  class="recommended-books-section"
  *ngIf="
    userAuthService.isLoggedIn() && (recommendedBooks$ | async) as recommended
  "
>
  <div class="section-wrap" *ngIf="recommended.length > 0">
    <div class="section-header">
      <h2 class="section-title">
        <i class="fas fa-magic"></i>
        C√≥ Th·ªÉ Em S·∫Ω Th√≠ch
      </h2>
      <p class="section-subtitle">
        G·ª£i √Ω d√†nh ri√™ng cho em d·ª±a tr√™n s·ªü th√≠ch ƒë·ªçc s√°ch
      </p>
    </div>

    <div class="books-grid">
      <a
        class="book-card"
        *ngFor="let book of recommended"
        [routerLink]="['/books', book.id]"
      >
        <div class="book-cover">
          <img
            [src]="
              book.coverUrl ||
              'https://placehold.co/200x300/161B22/8b949e?text=' +
                (book.name || '?').substring(0, 1)
            "
            alt="B√¨a s√°ch {{ book.name }}"
          />
        </div>
        <div class="book-info">
          <h3 class="book-title">{{ book.name }}</h3>
          <p class="book-author">
            <span *ngIf="book.authors && book.authors.length > 0">{{
              book.authors[0].name
            }}</span>
            <span *ngIf="!book.authors || book.authors.length === 0"
              >Nhi·ªÅu t√°c gi·∫£</span
            >
          </p>
        </div>
      </a>
    </div>
  </div>
</section>

<section class="new-books-section">
  <div class="section-wrap">
    <div class="section-header">
      <h2 class="section-title">S√°ch M·ªõi Nh·∫≠p</h2>
      <a routerLink="/borrow-book" class="view-all-link">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>

    <ng-container *ngIf="newestBooks$ | async as books; else loading">
      <div class="books-grid" *ngIf="books.length > 0; else empty">
        <a
          class="book-card"
          *ngFor="let book of books"
          [routerLink]="['/books', book.id]"
        >
          <div class="book-cover">
            <img
              [src]="
                book.coverUrl ||
                'https://placehold.co/200x300/161B22/8b949e?text=' +
                  (book.name || '?').substring(0, 1)
              "
              alt="B√¨a s√°ch {{ book.name }}"
            />
          </div>
          <div class="book-info">
            <h3 class="book-title">{{ book.name }}</h3>
            <p class="book-author">
              <span *ngIf="book.authors && book.authors.length > 0">{{
                book.authors[0].name
              }}</span>
              <span *ngIf="!book.authors || book.authors.length === 0"
                >Nhi·ªÅu t√°c gi·∫£</span
              >
            </p>
          </div>
        </a>
      </div>
    </ng-container>

    <ng-template #loading>
      <div class="books-grid">
        <div
          class="book-card-skeleton"
          *ngFor="let i of [1, 2, 3, 4, 5, 6]"
        ></div>
      </div>
    </ng-template>

    <ng-template #empty>
      <p class="text-muted text-center py-5">
        Hi·ªán t·∫°i ch∆∞a c√≥ s√°ch m·ªõi ƒë∆∞·ª£c c·∫≠p nh·∫≠t.
      </p>
    </ng-template>
  </div>
</section>

<footer class="site-footer">
  <div class="section-wrap">
    <div class="footer-grid">
      <div class="footer-col">
        <h3>Tr∆∞·ªùng THCS Ph∆∞∆°ng T√∫</h3>
        <p>
          <i class="fa-solid fa-location-dot me-2"></i> ƒê·ªãa ch·ªâ: X√£ Ph∆∞∆°ng T√∫,
          Huy·ªán ·ª®ng H√≤a, TP. H√† N·ªôi
        </p>
        <p><i class="fa-solid fa-phone me-2"></i> ƒêi·ªán tho·∫°i: 024.3xxx.xxxx</p>
        <p>
          <i class="fa-solid fa-envelope me-2"></i> Email:
          c2phuongtu-uh@hanoi.edu.vn
        </p>
      </div>

      <div class="footer-col">
        <h3>Li√™n K·∫øt Nhanh</h3>
        <nav class="footer-nav-vertical">
          <a routerLink="/borrow-book">Tra c·ª©u s√°ch</a>
          <a routerLink="/my-account">T√†i kho·∫£n c·ªßa t√¥i</a>
          <a routerLink="/rules">N·ªôi quy th∆∞ vi·ªán</a>
          <a href="#">L·ªãch ho·∫°t ƒë·ªông</a>
        </nav>
      </div>

      <div class="footer-col">
        <h3>Gi·ªù M·ªü C·ª≠a Th∆∞ Vi·ªán</h3>
        <ul class="opening-hours">
          <li><strong>Th·ª© 2 - Th·ª© 6:</strong></li>
          <li>S√°ng: 7:30 - 11:30</li>
          <li>Chi·ªÅu: 13:30 - 17:00</li>
          <li class="mt-2 text-warning">
            <i class="fa-solid fa-circle-exclamation me-1"></i> Ngh·ªâ Th·ª© 7, Ch·ªß
            Nh·∫≠t v√† c√°c ng√†y l·ªÖ.
          </li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>
        &copy; 2025 Th∆∞ Vi·ªán Tr∆∞·ªùng THCS Ph∆∞∆°ng T√∫. Ph√°t tri·ªÉn b·ªüi ƒê·ªôi ng≈© CNTT.
      </p>
    </div>
  </div>
</footer>
